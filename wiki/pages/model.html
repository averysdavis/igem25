{% extends "layout.html" %}

{% block title %}Model{% endblock %}
{% block lead %}
  <div class="page-header" id="model-header">
    <h1>Model</h1>
  </div>
{% endblock %}
{% block page_content %}
  <div data-bs-spy="scroll" data-bs-target="#myScrollspy" data-bs-offset="20" id="results">
    <div class="container">
      <div class="row">
        <!-- Scrollspy Sidebar -->
        <nav class="col-12 col-md-3 col-lg-2" id="myScrollspy" aria-label="Page section navigation">
          <div class="sticky-lg-top scrollspy-offset">
            <nav class="nav nav-pills flex-column" role="navigation">
              <a class="nav-link" href="#summary" aria-current="false">Summary</a>
              <a class="nav-link" href="#brainstorm" aria-current="false">Brainstorming</a>
              <a class="nav-link" href="#internal" aria-current="false">Internal Applications</a>
              <a class="nav-link" href="#external" aria-current="false">External Applications</a>
              <a class="nav-link" href="#conclusion" aria-current="false">Conclusion</a>
            </nav>
        </div>
      </nav>
        
        <!-- Main Content -->
        <div class="col-12 col-md-9" id="bumper">
          <div id="summary" class="mb-5">
            <h1>Summary</h1>
            <p>We built a reusable modeling and assay pipeline for biomineralization and demonstrated it on two of the field’s most common enzymes—carbonic anhydrase (CA) and urease. This page serves two purposes. First, it documents the internal modeling and analyses that guided our design choices. Second, it introduces a tool for future teams: a command‑line interface (CLI) pipeline that turns plate‑reader data into kinetic parameters and generates an ordinary differential equation (ODE) simulation to estimate CaCO₃ formation. Together, these components form the foundation of our dry‑lab work.</p>
            <p>Throughout development, our Human Practices conversations with mentors influenced how we approached modeling. They encouraged us to build something pragmatic and reproducible—a system that complements, not replaces, real experiments. We learned from Brian Ross that plate‑based quantitative data would be far more reliable than trying to predict complex wet‑lab results purely from simulations. As a result, our modeling shifted from an internal design driver to a planning‑grade tool that helps teams reason about experiments before stepping into the lab.</p>
          </div>
          <hr/>
          <!--Production-->
          <div id="brainstorm" class="mb-5">
            <h1>Brainstorming/Development Process</h1>
            <p>
              Our Drylab creation process was one filled with constant shifts in ideas. We started the season believing we would be 3D-modeling healing cracks in concrete, as well as exploring finite element modeling (which engineers use to simulate bridges collapsing). Then, with input from one of our mentors, Chirs and his colleague JJ Yeo at Cornell who works on models like these, he advised us to focus on the chemistry on our project first, suggesting an Ordinary Differential Equation (ODE) model first. As such, we adjusted the scope and goals of our Dry Lab to creating the ODE and ensuring we were integrated with and useful to our Wet Lab.
            </p>
          </div>
          <div id="internal" class="mb-5">
              <h1>Internal: Project‑Focused Modeling and Tools
              </h1>
              <p>Our internal modeling focused on practical decision‑making to guide our project. Each analysis answered a concrete design question and directly influenced what we built or tested.</p>
              <h2>Protein Candidate Triage
              </h2>
              <p>To identify the best biomineralizing proteins, we performed sequence analysis on several candidates. The results revealed that CARP (Coral Acid Rich Proteins) and SM50 are largely intrinsically disordered, with exposed acidic stretches and regions likely to interact with calcium. This flexibility and surface accessibility make them ideal scaffolds for mineral nucleation. By combining these observations with published studies, we focused on a smaller set of constructs that balanced expressibility and mineralization potential.
              </p>
              <p>This analysis simplified our build plan. Instead of testing every candidate in parallel, we prioritized CARP and SM50 for further experimentation, expecting them to yield soluble, effective fusion constructs</p>
              <h2>AlphaFold Visualizations</h2>
              <p>We used AlphaFold to visualize our selected proteins and evaluate their surface properties. These predicted models highlighted electrostatic regions, acidic patches, and possible calcium‑binding zones. We looked carefully at how these structural motifs might interact with our fusion tags and scaffolds. When visualizations showed potential clashes, we adjusted promoter strengths, linker lengths, and tag placements to preserve functional sites.
              </p>
              <p>These visual insights transformed modeling from a theoretical exercise into a design safeguard, ensuring our constructs remained biochemically reasonable before we ever ordered DNA.
              </p>
              <h2>Assay Design and Calibration
              </h2>
              <p>To convert enzyme activity measured in our Wet Lab to data that could be plugged into our ODE model, we implemented a phenol‑red plate assay for Carbonic Anhydrase and a colorimetric assay for urease. The principle is to turn changes in absorbance into pH, then into initial reaction rates (v₀), and finally into kinetic parameters which could then be plugged into our model.
              </p>
              <h3>From absorbance to pH</h3>
              <p>At wavelengths between 557–560 nm, phenol red shifts its absorbance depending on protonation. We first record A_min (fully acidic) and A_max (fully basic) buffer standards. For each reading A(t) (absorbance over time), we convert absorbance to pH using the Henderson–Hasselbalch equation :
              </p>
              <p>pH(t) = pKa + log₁₀((A(t) − A_min)/(A_max − A(t))).</p>
              <p>This method avoids dependence on extinction coefficients and minimizes error from optical drift. We obtain a continuous pH(t) curve for each well, the first part of which provides us with our v0 number, which can be plugged into our ODE code.</p>
              <h3>From pH to proton-equivalent rate</h3>
              <p>Because pH reflects proton concentration, we compute the rate of acid/base generation via the buffer capacity β (mol·L⁻¹·pH⁻¹). The instantaneous proton‑equivalent rate is given by:
              </p>
              <p>v_H(t) ≈ β × d(pH)/dt.</p>
              <p>The sign of v_H indicates whether acid or base is produced. For urease, base production raises pH (negative proton flux). For CA, proton flux depends on the hydration or dehydration direction; we use the magnitude for rate comparisons.
              </p>
              <h3>Detecting the v₀ window</h3>
              <p>Each absorbance trace contains a short linear region before substrate depletion or feedback effects occur. Our script:
              </p>
              <ul>
                <li>Skips the first 10–20 s to avoid mixing artifacts.
                </li>
                <li>Applies an optional Savitzky–Golay filter to visualize smooth trends while retaining raw data for fitting.</li>
                <li>Slides a fixed window (30–60 s) along the trace, performs a linear regression in each segment, and ranks them by R² and slope stability.
                </li>
                <li>Chooses the window with highest stability and least curvature to define v₀ = β·(dpH/dt).
                </li>
              </ul>
              <p>This approach is robust even for noisy curves and reproducible across replicates.
              </p>
              <h3>From v₀ to Michaelis–Menten parameters</h3>
              <p>We perform this process for each substrate concentration [S]₀ on a plate. Plotting v₀ vs. [S]₀, we fit the Michaelis–Menten model:</p>
              <p>v₀ = (Vmax × [S]₀)/(Km + [S]₀).
              </p>
              <p>Here Vmax = kcat × [E]total, but we fit Vmax directly without needing to know enzyme concentration. If [E] is later quantified, we calculate kcat = Vmax/[E].
              </p>
              <p>Nonlinear least‑squares fitting (Levenberg–Marquardt) gives best‑fit Vmax and Km, with 95% confidence intervals derived from the fit covariance matrix. We avoid Lineweaver–Burk transforms because they overweight low substrate points. Optional bootstrap resampling (1,000 iterations) provides additional error estimates. Weighted fits account for variance in each v₀ measurement.
              </p>
              <h3>Linking kinetics to the ODE
              </h3>
              <p>Once we obtain Vmax and Km, we feed them into a simplified ODE system that models the enzyme‑driven conversion of carbon species and pH evolution under the measured buffer capacity. The ODE incorporates a precipitation term triggered when carbonate concentration exceeds the Ksp of CaCO₃, allowing quick estimation of precipitation onset. Using the same β value keeps the simulation consistent with assay calibration.
              </p>
              <p>What it changed. This standard pipeline—absorbance → pH → v₀ → {Vmax, Km} → ODE—eliminated spreadsheet drift and made replicates directly comparable. It also gave us a transparent and defensible path from raw absorbance data to quantitative kinetic insight.
              </p>
              <h3>
                Math Details
              </h3>
              <p>Dual-wavelength ratio: R(t) = A560(t) / A435(t) after mapping the two instrument channels to ~560 nm (base) and ~435 nm (acid) within ±3 nm.
              </p>
              <p>Endpoint Henderson–Hasselbalch pH: pH(t) = pKa' + log10( (R(t) − Racid) / (Rbase − R(t)) ). When endpoints are not provided, the script estimates Racid and Rbase from pooled ratios by quantiles (defaults 2% and 98%).</p>
              <p>Initial slope window (v0): ignore the first t0 seconds (default 5 s), then fit a line on a window of width Δt (default 10 s): pH(t) ≈ m·t + b, where m = d(pH)/dt. Window quality is scored by R² and slope stability.</p>
              <p>Proton-equivalent rate via buffer capacity: vH = −β · d(pH)/dt = −β·m, where β is buffer capacity (mol·L⁻¹·pH⁻¹). Positive vH implies net acid production; base generation (urease) gives vH < 0. For Michaelis–Menten fitting we typically use |vH| as v0.
              </p>
              <p>Michaelis–Menten across a substrate series: v0 = (Vmax · [S]0) / (Km + [S]0). We fit Vmax and Km by nonlinear least squares (Levenberg–Marquardt), treating Vmax as free so [E] is not required. If [E] becomes available later, kcat = Vmax / [E]. Confidence intervals come from the fit covariance.</p>
              <p>Link to the ODE: the fitted Vmax, Km feed a minimal pH/carbonate ODE using the same β as calibration. Precipitation is triggered when the ion product exceeds Ksp: Ca²⁺ + CO₃²⁻ → CaCO₃(s). We use a lumped precipitation rate kp suitable for planning-grade estimates.</p>
              <h2>Biomineralization Mold CAD</h2>
              <p>To validate mineral formation in a repeatable way, we designed and 3D‑printed standardized PDMS molds for biomineralization. Each mold controlled liquid volume, flow paths, and geometry, enabling uniform growth and comparable imaging. This mechanical standardization allowed us to link enzymatic data with measurable deposition outcomes.
              </p>
              <p>In summary, these internal models and design tools shaped nearly every major decision—from narrowing protein candidates to defining experimental conditions. They provided the scaffolding for the reproducible, quantitative system that follows.</p>
          <div id="external" class="mb-5">
            <h1>External: Reusable Modeling Pipeline for Future Teams</h1>
            <h2>Overview</h2>
            <p>Our external contribution is a Kinetics‑to‑Model Pipeline that integrates assay analysis and ODE simulation. It is designed for iGEM teams studying biomineralization, especially those working with CA or urease, where teams often struggle to connect plate‑reader data with predictive modeling. Using a simple CLI, the pipeline automatically detects linear regions in absorbance curves, calculates kinetic parameters, and runs a short ODE simulation that estimates carbonate conversion and CaCO₃ formation. This helps teams visualize expected mineralization dynamics before committing extensive resources to benchwork.
            </p>
            <h2>How it works</h2>
            <p>The user begins with a plate‑reader CSV file—time vs. absorbance—accompanied by metadata such as pathlength, wavelength, temperature, and buffer composition. After running one command in the terminal, the pipeline performs several automated steps:
            </p>
            <ol>
              <li>Data ingestion and cleaning. The script standardizes formatting, smooths noise, and identifies baseline drift.
              </li>
              <li>Initial‑rate detection. It locates the early linear segment of the absorbance curve and fits a regression to compute v₀.
              </li>
              <li>Kinetic parameter estimation. Using a Michaelis–Menten framework, the tool fits Vmax and Km (or effective rate constants) with units and confidence intervals.
              </li>
              <li>ODE simulation. The model then predicts changes in pH and carbonate concentration, triggering a precipitation event when the ion product exceeds the solubility product (Ksp).</li>
              <li>Reporting. Finally, it outputs publication‑ready plots, parameter JSON files, and a concise markdown report summarizing assumptions and fit quality.
              </li>
            </ol>
            <p>The entire process—from CSV to simulated output—takes less than a minute. All default parameters are editable, making it easy to adapt for new enzymes or conditions.
            </p>
            <h2>What it produces
            </h2>
            <p>The pipeline outputs kinetic parameters (JSON with units), diagnostic plots (PNG), simulated trajectories of carbonate and pH, and a markdown report describing the experiment and results. These files can be directly uploaded to wikis or used to compare enzyme efficiencies between teams.</p>
            <h2>Underlying mathematics
            </h2>
            <p>The core kinetic models use Michaelis–Menten equations for urease and CA. The system links enzyme activity to pH through the Henderson–Hasselbalch equation, adding a simple buffer‑capacity term. When carbonate and calcium concentrations reach supersaturation, a lumped precipitation term converts soluble ions into solid CaCO₃. This minimal model is fast, interpretable, and sufficiently accurate for experimental planning.
            </p>
            <h2>Human Practices integration
            </h2>
            <p>Mentor Brian Ross emphasized the importance of plate‑based measurements and encouraged us to use modeling for planning, not prediction. Abigail Alemayeho guided our inclusion of metabolic burden awareness—reminding us that expression cannot simply be “maxed out.” These conversations grounded our model in realistic biological limits. We present this pipeline as a planning companion rather than a mechanistic authority.</p>
            <h2>Assumptions and limitations
            </h2>
            <p>We assume well‑mixed conditions and uniform optical paths across wells. Ionic strength effects are approximated, and precipitation is modeled as a lumped process without explicit surface nucleation. Whole‑cell metabolic burden is excluded by design. Users should treat all outputs as estimates and confirm them experimentally.</p>
            <p>Common error cases—such as saturated absorbance or malformed CSVs—are documented in the README with suggested fixes.
            </p>
            <h2>Validation</h2>
            <p>We validated the pipeline by comparing fitted kinetic curves with experimental data from CA and urease assays. Overlay plots show that the model reproduces early‑time behavior accurately and provides reasonable long‑term estimates. We explicitly note that this validation is qualitative: the goal is consistent trends, not perfect replication.</p>
            <h2>Downloads</h2>
            <ul>
              <li>Example datasets: CA and urease plate‑reader CSVs (raw and cleaned).
              </li>
              <li>Parameter JSON files: fitted parameters with units.
              </li>
              <li>Generated reports: Markdown/PDF containing QA plots and summaries.
              </li>
              <li>Mold CAD: standardized STL files for biomineralization tests.
              </li>
              <li>Repository: <a href = "https://gitlab.igem.org/2025/software-tools/khanlab-bayarea">https://gitlab.igem.org/2025/software-tools/khanlab-bayarea</a>.
              </li>
            </ul>
          </div>
          <div id = "conclusion" class = "mb-5">
            <h1>Conclusion</h1>
            <p>This modeling pipeline began as a tool for our own measurements but grew into something more general. By combining simple automation with transparent equations, we hope to make kinetic modeling approachable for any iGEM team studying biomineralization. Whether used to estimate carbonate output, compare enzyme variants, or plan plate‑based assays, this tool translates raw absorbance into insight—and makes the dry‑lab accessible to every team.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}


